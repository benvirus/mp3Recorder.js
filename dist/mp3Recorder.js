(function(f){if(typeof exports==="object"&&typeof module!=="undefined"){module.exports=f()}else if(typeof define==="function"&&define.amd){define([],f)}else{var g;if(typeof window!=="undefined"){g=window}else if(typeof global!=="undefined"){g=global}else if(typeof self!=="undefined"){g=self}else{g=this}g.MP3Recorder = f()}})(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(require,module,exports){
var bundleFn = arguments[3];
var sources = arguments[4];
var cache = arguments[5];

var stringify = JSON.stringify;

module.exports = function (fn, options) {
    var wkey;
    var cacheKeys = Object.keys(cache);

    for (var i = 0, l = cacheKeys.length; i < l; i++) {
        var key = cacheKeys[i];
        var exp = cache[key].exports;
        // Using babel as a transpiler to use esmodule, the export will always
        // be an object with the default export as a property of it. To ensure
        // the existing api and babel esmodule exports are both supported we
        // check for both
        if (exp === fn || exp && exp.default === fn) {
            wkey = key;
            break;
        }
    }

    if (!wkey) {
        wkey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);
        var wcache = {};
        for (var i = 0, l = cacheKeys.length; i < l; i++) {
            var key = cacheKeys[i];
            wcache[key] = key;
        }
        sources[wkey] = [
            Function(['require','module','exports'], '(' + fn + ')(self)'),
            wcache
        ];
    }
    var skey = Math.floor(Math.pow(16, 8) * Math.random()).toString(16);

    var scache = {}; scache[wkey] = wkey;
    sources[skey] = [
        Function(['require'], (
            // try to call default if defined to also support babel esmodule
            // exports
            'var f = require(' + stringify(wkey) + ');' +
            '(f.default ? f.default : f)(self);'
        )),
        scache
    ];

    var workerSources = {};
    resolveSources(skey);

    function resolveSources(key) {
        workerSources[key] = true;

        for (var depPath in sources[key][1]) {
            var depKey = sources[key][1][depPath];
            if (!workerSources[depKey]) {
                resolveSources(depKey);
            }
        }
    }

    var src = '(' + bundleFn + ')({'
        + Object.keys(workerSources).map(function (key) {
            return stringify(key) + ':['
                + sources[key][0]
                + ',' + stringify(sources[key][1]) + ']'
            ;
        }).join(',')
        + '},{},[' + stringify(skey) + '])'
    ;

    var URL = window.URL || window.webkitURL || window.mozURL || window.msURL;

    var blob = new Blob([src], { type: 'text/javascript' });
    if (options && options.bare) { return blob; }
    var workerUrl = URL.createObjectURL(blob);
    var worker = new Worker(workerUrl);
    worker.objectURL = workerUrl;
    return worker;
};

},{}],2:[function(require,module,exports){
'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _typeof=typeof Symbol==="function"&&typeof Symbol.iterator==="symbol"?function(obj){return typeof obj;}:function(obj){return obj&&typeof Symbol==="function"&&obj.constructor===Symbol&&obj!==Symbol.prototype?"symbol":typeof obj;};var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _recorder=require('./recorder.js');var _recorder2=_interopRequireDefault(_recorder);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var MP3Recorder=function(){function MP3Recorder(){var _this=this;_classCallCheck(this,MP3Recorder);try{window.AudioContext=window.AudioContext||window.webkitAudioContext;window.navigator.getUserMedia=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia;window.URL=window.URL||window.webkitURL;this.audio_context=new AudioContext();}catch(e){alert('No web audio support in this browser!');}navigator.getUserMedia({audio:true},function(stream){var input=_this.audio_context.createMediaStreamSource(stream);_this.recorder=new _recorder2.default(input,{numChannels:1});},function(e){__log('No live audio input: '+e);});}_createClass(MP3Recorder,[{key:'start',value:function start(){this.recorder.record();}},{key:'stop',value:function stop(){this.recorder.stop();}},{key:'finish',value:function finish(){}}]);return MP3Recorder;}();if(typeof define==='function'&&define.amd){define('MP3Recorder',[],function(){return MP3Recorder;});// checking that module is an object too because of umdjs/umd#35
}else if((typeof exports==='undefined'?'undefined':_typeof(exports))==='object'&&(typeof module==='undefined'?'undefined':_typeof(module))==='object'){module.exports=MP3Recorder;}exports.default=MP3Recorder;

},{"./recorder.js":4}],3:[function(require,module,exports){
'use strict';Object.defineProperty(exports,"__esModule",{value:true});var mp3codec;exports.default=function(self){importScripts('https://ben.mp3-recorder.com/dist/libmp3lame.min.js');self.addEventListener('message',function(e){console.log(e.data);switch(e.data.cmd){case'init':if(!e.data.config){e.data.config={};}mp3codec=Lame.init();Lame.set_mode(mp3codec,e.data.config.mode||Lame.JOINT_STEREO);Lame.set_num_channels(mp3codec,e.data.config.channels||2);Lame.set_num_samples(mp3codec,e.data.config.samples||-1);Lame.set_in_samplerate(mp3codec,e.data.config.samplerate||44100);Lame.set_out_samplerate(mp3codec,e.data.config.samplerate||44100);Lame.set_bitrate(mp3codec,e.data.config.bitrate||128);Lame.init_params(mp3codec);console.log('Version :',Lame.get_version()+' / ','Mode: '+Lame.get_mode(mp3codec)+' / ','Samples: '+Lame.get_num_samples(mp3codec)+' / ','Channels: '+Lame.get_num_channels(mp3codec)+' / ','Input Samplate: '+Lame.get_in_samplerate(mp3codec)+' / ','Output Samplate: '+Lame.get_in_samplerate(mp3codec)+' / ','Bitlate :'+Lame.get_bitrate(mp3codec)+' / ','VBR :'+Lame.get_VBR(mp3codec));break;case'encode':var mp3data=Lame.encode_buffer_ieee_float(mp3codec,e.data.buf,e.data.buf);self.postMessage({cmd:'data',buf:mp3data.data});break;case'finish':var mp3data=Lame.encode_flush(mp3codec);self.postMessage({cmd:'end',buf:mp3data.data});Lame.close(mp3codec);mp3codec=null;break;}});};

},{}],4:[function(require,module,exports){
'use strict';Object.defineProperty(exports,"__esModule",{value:true});var _createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||false;descriptor.configurable=true;if("value"in descriptor)descriptor.writable=true;Object.defineProperty(target,descriptor.key,descriptor);}}return function(Constructor,protoProps,staticProps){if(protoProps)defineProperties(Constructor.prototype,protoProps);if(staticProps)defineProperties(Constructor,staticProps);return Constructor;};}();var _webworkify=require('webworkify');var _webworkify2=_interopRequireDefault(_webworkify);function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj};}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor)){throw new TypeError("Cannot call a class as a function");}}var segmentNum=0;var Uint8ArrayToFloat32Array=function Uint8ArrayToFloat32Array(u8a){var f32Buffer=new Float32Array(u8a.length);for(var i=0;i<u8a.length;i++){var value=u8a[i<<1]+(u8a[(i<<1)+1]<<8);if(value>=0x8000)value|=~0x7FFF;f32Buffer[i]=value/0x8000;}return f32Buffer;};var Recorder=function(){function Recorder(source,cfg){var _this=this;_classCallCheck(this,Recorder);var config=cfg||{};var bufferLen=config.bufferLen||4096;var numChannels=config.numChannels||2;this.context=source.context;this.node=(this.context.createScriptProcessor||this.context.createJavaScriptNode).call(this.context,bufferLen,numChannels,numChannels);this.recorderWorker=new _webworkify2.default(require('./recorderWorker.js'));this.recorderWorker.onmessage=function(e){var buffer=new Uint8Array(e.data);segmentNum++;encoderWorker.postMessage({cmd:'encode',buf:Uint8ArrayToFloat32Array(buffer)});};this.recorderWorker.postMessage({command:'init',config:{sampleRate:this.context.sampleRate,numChannels:numChannels}});var encoderWorker=new _webworkify2.default(require('./mp3Worker.js'));encoderWorker.postMessage({cmd:'init',config:{mode:3,channels:1,samplerate:44100,bitrate:16}});this.node.onaudioprocess=function(e){console.log(111);if(!_this.recording)return;var buffer=[];for(var channel=0;channel<numChannels;channel++){buffer.push(e.inputBuffer.getChannelData(channel));}_this.recorderWorker.postMessage({command:'record',buffer:buffer});};source.connect(this.node);this.node.connect(this.context.destination);}_createClass(Recorder,[{key:'record',value:function record(){this.recording=true;console.log(this.recording);}},{key:'stop',value:function stop(){this.recording=false;console.log(this.recording);}},{key:'clear',value:function clear(){this.worker.postMessage({command:'clear'});}}]);return Recorder;}();exports.default=Recorder;

},{"./mp3Worker.js":3,"./recorderWorker.js":5,"webworkify":1}],5:[function(require,module,exports){
'use strict';Object.defineProperty(exports,"__esModule",{value:true});var recLength=0,recBuffers=[],sampleRate,numChannels;function init(config){sampleRate=config.sampleRate;numChannels=config.numChannels;initBuffers();}function clear(){recLength=0;recBuffers=[];initBuffers();}function initBuffers(){for(var channel=0;channel<numChannels;channel++){recBuffers[channel]=[];}}function mergeBuffers(recBuffers,recLength){var result=new Float32Array(recLength);var offset=0;for(var i=0;i<recBuffers.length;i++){result.set(recBuffers[i],offset);offset+=recBuffers[i].length;}return result;}function interleave(inputL,inputR){var length=inputL.length+inputR.length;var result=new Float32Array(length);var index=0,inputIndex=0;while(index<length){result[index++]=inputL[inputIndex];result[index++]=inputR[inputIndex];inputIndex++;}return result;}function floatTo16BitPCM(output,offset,input){for(var i=0;i<input.length;i++,offset+=2){var s=Math.max(-1,Math.min(1,input[i]));output.setInt16(offset,s<0?s*0x8000:s*0x7FFF,true);}}function writeString(view,offset,string){for(var i=0;i<string.length;i++){view.setUint8(offset+i,string.charCodeAt(i));}}function encodeWAV(samples){var buffer=new ArrayBuffer(samples.length*2);var view=new DataView(buffer);floatTo16BitPCM(view,0,samples);return view;}exports.default=function(self){self.addEventListener('message',function(e){switch(e.data.command){case'init':init(e.data.config);break;case'record':record(e.data.buffer);break;case'exportWAV':exportWAV(e.data.type);break;case'getBuffer':getBuffer();break;case'clear':clear();break;}});function record(inputBuffer){for(var channel=0;channel<numChannels;channel++){recBuffers[channel]=[];recBuffers[channel].push(inputBuffer[channel]);}recLength=inputBuffer[0].length;exportWAV();}function exportWAV(){var buffers=[];for(var channel=0;channel<numChannels;channel++){buffers.push(mergeBuffers(recBuffers[channel],recLength));}if(numChannels===2){var interleaved=interleave(buffers[0],buffers[1]);}else{var interleaved=buffers[0];}var dataview=encodeWAV(interleaved);self.postMessage(dataview.buffer);}};

},{}]},{},[2])(2)
});
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIm5vZGVfbW9kdWxlcy9icm93c2VyLXBhY2svX3ByZWx1ZGUuanMiLCJub2RlX21vZHVsZXMvd2Vid29ya2lmeS9pbmRleC5qcyIsInNyYy9tYWluLmpzIiwic3JjL21wM1dvcmtlci5qcyIsInNyYy9yZWNvcmRlci5qcyIsInNyYy9yZWNvcmRlcldvcmtlci5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQ0FBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBO0FBQ0E7QUFDQTtBQUNBOzs2eUJDakZBLHVDLHdSQUVNLFksWUFDSixzQkFBYSxrREFDWCxHQUFJLENBQ0YsT0FBTyxZQUFQLENBQXNCLE9BQU8sWUFBUCxFQUF1QixPQUFPLGtCQUFwRCxDQUNBLE9BQU8sU0FBUCxDQUFpQixZQUFqQixDQUNFLFVBQVUsWUFBVixFQUNBLFVBQVUsa0JBRFYsRUFFQSxVQUFVLGVBRlYsRUFHQSxVQUFVLGNBSlosQ0FLQSxPQUFPLEdBQVAsQ0FBYSxPQUFPLEdBQVAsRUFBYyxPQUFPLFNBQWxDLENBRUEsS0FBSyxhQUFMLENBQXFCLEdBQUksYUFBSixFQUFyQixDQUNELENBQUMsTUFBTSxDQUFOLENBQVMs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RCxDQUNELEdBQUksY0FBZ0IsQ0FBcEIsQ0FBdUIsQ0FDckIsR0FBSSxhQUFjLFdBQVcsUUFBUSxDQUFSLENBQVgsQ0FBdUIsUUFBUSxDQUFSLENBQXZCLENBQWxCLENBQ0QsQ0FGRCxJQUVPLENBQ0wsR0FBSSxhQUFjLFFBQVEsQ0FBUixDQUFsQixDQUNELENBQ0QsR0FBSSxVQUFXLFVBQVUsV0FBVixDQUFmLENBRUEsS0FBSyxXQUFMLENBQWlCLFNBQVMsTUFBMUIsRUFDRCxDQUNGLEMiLCJmaWxlIjoiZ2VuZXJhdGVkLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXNDb250ZW50IjpbIihmdW5jdGlvbiBlKHQsbixyKXtmdW5jdGlvbiBzKG8sdSl7aWYoIW5bb10pe2lmKCF0W29dKXt2YXIgYT10eXBlb2YgcmVxdWlyZT09XCJmdW5jdGlvblwiJiZyZXF1aXJlO2lmKCF1JiZhKXJldHVybiBhKG8sITApO2lmKGkpcmV0dXJuIGkobywhMCk7dmFyIGY9bmV3IEVycm9yKFwiQ2Fubm90IGZpbmQgbW9kdWxlICdcIitvK1wiJ1wiKTt0aHJvdyBmLmNvZGU9XCJNT0RVTEVfTk9UX0ZPVU5EXCIsZn12YXIgbD1uW29dPXtleHBvcnRzOnt9fTt0W29dWzBdLmNhbGwobC5leHBvcnRzLGZ1bmN0aW9uKGUpe3ZhciBuPXRbb11bMV1bZV07cmV0dXJuIHMobj9uOmUpfSxsLGwuZXhwb3J0cyxlLHQsbixyKX1yZXR1cm4gbltvXS5leHBvcnRzfXZhciBpPXR5cGVvZiByZXF1aXJlPT1cImZ1bmN0aW9uXCImJnJlcXVpcmU7Zm9yKHZhciBvPTA7bzxyLmxlbmd0aDtvKyspcyhyW29dKTtyZXR1cm4gc30pIiwidmFyIGJ1bmRsZUZuID0gYXJndW1lbnRzWzNdO1xudmFyIHNvdXJjZXMgPSBhcmd1bWVudHNbNF07XG52YXIgY2FjaGUgPSBhcmd1bWVudHNbNV07XG5cbnZhciBzdHJpbmdpZnkgPSBKU09OLnN0cmluZ2lmeTtcblxubW9kdWxlLmV4cG9ydHMgPSBmdW5jdGlvbiAoZm4sIG9wdGlvbnMpIHtcbiAgICB2YXIgd2tleTtcbiAgICB2YXIgY2FjaGVLZXlzID0gT2JqZWN0LmtleXMoY2FjaGUpO1xuXG4gICAgZm9yICh2YXIgaSA9IDAsIGwgPSBjYWNoZUtleXMubGVuZ3RoOyBpIDwgbDsgaSsrKSB7XG4gICAgICAgIHZhciBrZXkgPSBjYWNoZUtleXNbaV07XG4gICAgICAgIHZhciBleHAgPSBjYWNoZVtrZXldLmV4cG9ydHM7XG4gICAgICAgIC8vIFVzaW5nIGJhYmVsIGFzIGEgdHJhbnNwaWxlciB0byB1c2UgZXNtb2R1bGUsIHRoZSBleHBvcnQgd2lsbCBhbHdheXNcbiAgICAgICAgLy8gYmUgYW4gb2JqZWN0IHdpdGggdGhlIGRlZmF1bHQgZXhwb3J0IGFzIGEgcHJvcGVydHkgb2YgaXQuIFRvIGVuc3VyZVxuICAgICAgICAvLyB0aGUgZXhpc3RpbmcgYXBpIGFuZCBiYWJlbCBlc21vZHVsZSBleHBvcnRzIGFyZSBib3RoIHN1cHBvcnRlZCB3ZVxuICAgICAgICAvLyBjaGVjayBmb3IgYm90aFxuICAgICAgICBpZiAoZXhwID09PSBmbiB8fCBleHAgJiYgZXhwLmRlZmF1bHQgPT09IGZuKSB7XG4gICAgICAgICAgICB3a2V5ID0ga2V5O1xuICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoIXdrZXkpIHtcbiAgICAgICAgd2tleSA9IE1hdGguZmxvb3IoTWF0aC5wb3coMTYsIDgpICogTWF0aC5yYW5kb20oKSkudG9TdHJpbmcoMTYpO1xuICAgICAgICB2YXIgd2NhY2hlID0ge307XG4gICAgICAgIGZvciAodmFyIGkgPSAwLCBsID0gY2FjaGVLZXlzLmxlbmd0aDsgaSA8IGw7IGkrKykge1xuICAgICAgICAgICAgdmFyIGtleSA9IGNhY2hlS2V5c1tpXTtcbiAgICAgICAgICAgIHdjYWNoZVtrZXldID0ga2V5O1xuICAgICAgICB9XG4gICAgICAgIHNvdXJjZXNbd2tleV0gPSBbXG4gICAgICAgICAgICBGdW5jdGlvbihbJ3JlcXVpcmUnLCdtb2R1bGUnLCdleHBvcnRzJ10sICcoJyArIGZuICsgJykoc2VsZiknKSxcbiAgICAgICAgICAgIHdjYWNoZVxuICAgICAgICBdO1xuICAgIH1cbiAgICB2YXIgc2tleSA9IE1hdGguZmxvb3IoTWF0aC5wb3coMTYsIDgpICogTWF0aC5yYW5kb20oKSkudG9TdHJpbmcoMTYpO1xuXG4gICAgdmFyIHNjYWNoZSA9IHt9OyBzY2FjaGVbd2tleV0gPSB3a2V5O1xuICAgIHNvdXJjZXNbc2tleV0gPSBbXG4gICAgICAgIEZ1bmN0aW9uKFsncmVxdWlyZSddLCAoXG4gICAgICAgICAgICAvLyB0cnkgdG8gY2FsbCBkZWZhdWx0IGlmIGRlZmluZWQgdG8gYWxzbyBzdXBwb3J0IGJhYmVsIGVzbW9kdWxlXG4gICAgICAgICAgICAvLyBleHBvcnRzXG4gICAgICAgICAgICAndmFyIGYgPSByZXF1aXJlKCcgKyBzdHJpbmdpZnkod2tleSkgKyAnKTsnICtcbiAgICAgICAgICAgICcoZi5kZWZhdWx0ID8gZi5kZWZhdWx0IDogZikoc2VsZik7J1xuICAgICAgICApKSxcbiAgICAgICAgc2NhY2hlXG4gICAgXTtcblxuICAgIHZhciB3b3JrZXJTb3VyY2VzID0ge307XG4gICAgcmVzb2x2ZVNvdXJjZXMoc2tleSk7XG5cbiAgICBmdW5jdGlvbiByZXNvbHZlU291cmNlcyhrZXkpIHtcbiAgICAgICAgd29ya2VyU291cmNlc1trZXldID0gdHJ1ZTtcblxuICAgICAgICBmb3IgKHZhciBkZXBQYXRoIGluIHNvdXJjZXNba2V5XVsxXSkge1xuICAgICAgICAgICAgdmFyIGRlcEtleSA9IHNvdXJjZXNba2V5XVsxXVtkZXBQYXRoXTtcbiAgICAgICAgICAgIGlmICghd29ya2VyU291cmNlc1tkZXBLZXldKSB7XG4gICAgICAgICAgICAgICAgcmVzb2x2ZVNvdXJjZXMoZGVwS2V5KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH1cblxuICAgIHZhciBzcmMgPSAnKCcgKyBidW5kbGVGbiArICcpKHsnXG4gICAgICAgICsgT2JqZWN0LmtleXMod29ya2VyU291cmNlcykubWFwKGZ1bmN0aW9uIChrZXkpIHtcbiAgICAgICAgICAgIHJldHVybiBzdHJpbmdpZnkoa2V5KSArICc6WydcbiAgICAgICAgICAgICAgICArIHNvdXJjZXNba2V5XVswXVxuICAgICAgICAgICAgICAgICsgJywnICsgc3RyaW5naWZ5KHNvdXJjZXNba2V5XVsxXSkgKyAnXSdcbiAgICAgICAgICAgIDtcbiAgICAgICAgfSkuam9pbignLCcpXG4gICAgICAgICsgJ30se30sWycgKyBzdHJpbmdpZnkoc2tleSkgKyAnXSknXG4gICAgO1xuXG4gICAgdmFyIFVSTCA9IHdpbmRvdy5VUkwgfHwgd2luZG93LndlYmtpdFVSTCB8fCB3aW5kb3cubW96VVJMIHx8IHdpbmRvdy5tc1VSTDtcblxuICAgIHZhciBibG9iID0gbmV3IEJsb2IoW3NyY10sIHsgdHlwZTogJ3RleHQvamF2YXNjcmlwdCcgfSk7XG4gICAgaWYgKG9wdGlvbnMgJiYgb3B0aW9ucy5iYXJlKSB7IHJldHVybiBibG9iOyB9XG4gICAgdmFyIHdvcmtlclVybCA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYik7XG4gICAgdmFyIHdvcmtlciA9IG5ldyBXb3JrZXIod29ya2VyVXJsKTtcbiAgICB3b3JrZXIub2JqZWN0VVJMID0gd29ya2VyVXJsO1xuICAgIHJldHVybiB3b3JrZXI7XG59O1xuIiwiaW1wb3J0IFJlY29yZGVyIGZyb20gJy4vcmVjb3JkZXIuanMnO1xuXG5jbGFzcyBNUDNSZWNvcmRlciB7XG4gIGNvbnN0cnVjdG9yKCl7XG4gICAgdHJ5IHtcbiAgICAgIHdpbmRvdy5BdWRpb0NvbnRleHQgPSB3aW5kb3cuQXVkaW9Db250ZXh0IHx8IHdpbmRvdy53ZWJraXRBdWRpb0NvbnRleHQ7XG4gICAgICB3aW5kb3cubmF2aWdhdG9yLmdldFVzZXJNZWRpYSA9IChcbiAgICAgICAgbmF2aWdhdG9yLmdldFVzZXJNZWRpYSB8fFxuICAgICAgICBuYXZpZ2F0b3Iud2Via2l0R2V0VXNlck1lZGlhIHx8XG4gICAgICAgIG5hdmlnYXRvci5tb3pHZXRVc2VyTWVkaWEgfHxcbiAgICAgICAgbmF2aWdhdG9yLm1zR2V0VXNlck1lZGlhKTtcbiAgICAgIHdpbmRvdy5VUkwgPSB3aW5kb3cuVVJMIHx8IHdpbmRvdy53ZWJraXRVUkw7XG5cbiAgICAgIHRoaXMuYXVkaW9fY29udGV4dCA9IG5ldyBBdWRpb0NvbnRleHQ7XG4gICAgfSBjYXRjaChlKSB7XG4gICAgICBhbGVydCgnTm8gd2ViIGF1ZGlvIHN1cHBvcnQgaW4gdGhpcyBicm93c2VyIScpO1xuICAgIH1cblxuICAgIG5hdmlnYXRvci5nZXRVc2VyTWVkaWEoe1xuICAgICAgYXVkaW86IHRydWVcbiAgICB9LCBzdHJlYW0gPT4ge1xuICAgICAgbGV0IGlucHV0ID0gdGhpcy5hdWRpb19jb250ZXh0LmNyZWF0ZU1lZGlhU3RyZWFtU291cmNlKHN0cmVhbSk7XG4gICAgICB0aGlzLnJlY29yZGVyID0gbmV3IFJlY29yZGVyKGlucHV0LCB7XG4gICAgICAgIG51bUNoYW5uZWxzOiAxXG4gICAgICB9KTtcbiAgICB9LCBlID0+IHtcbiAgICAgIF9fbG9nKCdObyBsaXZlIGF1ZGlvIGlucHV0OiAnICsgZSk7XG4gICAgfSk7XG4gIH1cblxuICBzdGFydCgpe1xuICAgIHRoaXMucmVjb3JkZXIucmVjb3JkKCk7XG4gIH1cblxuICBzdG9wKCl7XG4gICAgdGhpcy5yZWNvcmRlci5zdG9wKCk7XG4gIH1cblxuICBmaW5pc2goKXtcblxuICB9XG59XG5cbmlmICh0eXBlb2YgZGVmaW5lID09PSAnZnVuY3Rpb24nICYmIGRlZmluZS5hbWQpIHtcbiAgZGVmaW5lKCdNUDNSZWNvcmRlcicsIFtdLCAoKSA9PiBNUDNSZWNvcmRlcik7XG4vLyBjaGVja2luZyB0aGF0IG1vZHVsZSBpcyBhbiBvYmplY3QgdG9vIGJlY2F1c2Ugb2YgdW1kanMvdW1kIzM1XG59IGVsc2UgaWYgKHR5cGVvZiBleHBvcnRzID09PSAnb2JqZWN0JyAmJiB0eXBlb2YgbW9kdWxlID09PSAnb2JqZWN0Jykge1xuICBtb2R1bGUuZXhwb3J0cyA9IE1QM1JlY29yZGVyO1xufVxuXG5leHBvcnQgZGVmYXVsdCBNUDNSZWNvcmRlcjsiLCJcbnZhciBtcDNjb2RlYztcblxuZXhwb3J0IGRlZmF1bHQgKHNlbGYpID0+IHtcblxuICBpbXBvcnRTY3JpcHRzKCdodHRwczovL2Jlbi5tcDMtcmVjb3JkZXIuY29tL2Rpc3QvbGlibXAzbGFtZS5taW4uanMnKTtcblxuICBzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCAoZSkgPT4ge1xuICAgIGNvbnNvbGUubG9nKGUuZGF0YSlcbiAgICBzd2l0Y2ggKGUuZGF0YS5jbWQpIHtcbiAgICAgIGNhc2UgJ2luaXQnOlxuICAgICAgICBpZiAoIWUuZGF0YS5jb25maWcpIHtcbiAgICAgICAgICBlLmRhdGEuY29uZmlnID0ge307XG4gICAgICAgIH1cbiAgICAgICAgbXAzY29kZWMgPSBMYW1lLmluaXQoKTtcblxuICAgICAgICBMYW1lLnNldF9tb2RlKG1wM2NvZGVjLCBlLmRhdGEuY29uZmlnLm1vZGUgfHwgTGFtZS5KT0lOVF9TVEVSRU8pO1xuICAgICAgICBMYW1lLnNldF9udW1fY2hhbm5lbHMobXAzY29kZWMsIGUuZGF0YS5jb25maWcuY2hhbm5lbHMgfHwgMik7XG4gICAgICAgIExhbWUuc2V0X251bV9zYW1wbGVzKG1wM2NvZGVjLCBlLmRhdGEuY29uZmlnLnNhbXBsZXMgfHwgLTEpO1xuICAgICAgICBMYW1lLnNldF9pbl9zYW1wbGVyYXRlKG1wM2NvZGVjLCBlLmRhdGEuY29uZmlnLnNhbXBsZXJhdGUgfHwgNDQxMDApO1xuICAgICAgICBMYW1lLnNldF9vdXRfc2FtcGxlcmF0ZShtcDNjb2RlYywgZS5kYXRhLmNvbmZpZy5zYW1wbGVyYXRlIHx8IDQ0MTAwKTtcbiAgICAgICAgTGFtZS5zZXRfYml0cmF0ZShtcDNjb2RlYywgZS5kYXRhLmNvbmZpZy5iaXRyYXRlIHx8IDEyOCk7XG4gICAgICAgIExhbWUuaW5pdF9wYXJhbXMobXAzY29kZWMpO1xuICAgICAgICBjb25zb2xlLmxvZygnVmVyc2lvbiA6JywgTGFtZS5nZXRfdmVyc2lvbigpICsgJyAvICcsXG4gICAgICAgICAgJ01vZGU6ICcgKyBMYW1lLmdldF9tb2RlKG1wM2NvZGVjKSArICcgLyAnLFxuICAgICAgICAgICdTYW1wbGVzOiAnICsgTGFtZS5nZXRfbnVtX3NhbXBsZXMobXAzY29kZWMpICsgJyAvICcsXG4gICAgICAgICAgJ0NoYW5uZWxzOiAnICsgTGFtZS5nZXRfbnVtX2NoYW5uZWxzKG1wM2NvZGVjKSArICcgLyAnLFxuICAgICAgICAgICdJbnB1dCBTYW1wbGF0ZTogJyArIExhbWUuZ2V0X2luX3NhbXBsZXJhdGUobXAzY29kZWMpICsgJyAvICcsXG4gICAgICAgICAgJ091dHB1dCBTYW1wbGF0ZTogJyArIExhbWUuZ2V0X2luX3NhbXBsZXJhdGUobXAzY29kZWMpICsgJyAvICcsXG4gICAgICAgICAgJ0JpdGxhdGUgOicgKyBMYW1lLmdldF9iaXRyYXRlKG1wM2NvZGVjKSArICcgLyAnLFxuICAgICAgICAgICdWQlIgOicgKyBMYW1lLmdldF9WQlIobXAzY29kZWMpKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdlbmNvZGUnOlxuICAgICAgICB2YXIgbXAzZGF0YSA9IExhbWUuZW5jb2RlX2J1ZmZlcl9pZWVlX2Zsb2F0KG1wM2NvZGVjLCBlLmRhdGEuYnVmLCBlLmRhdGEuYnVmKTtcbiAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7IGNtZDogJ2RhdGEnLCBidWY6IG1wM2RhdGEuZGF0YSB9KTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdmaW5pc2gnOlxuICAgICAgICB2YXIgbXAzZGF0YSA9IExhbWUuZW5jb2RlX2ZsdXNoKG1wM2NvZGVjKTtcbiAgICAgICAgc2VsZi5wb3N0TWVzc2FnZSh7IGNtZDogJ2VuZCcsIGJ1ZjogbXAzZGF0YS5kYXRhIH0pO1xuICAgICAgICBMYW1lLmNsb3NlKG1wM2NvZGVjKTtcbiAgICAgICAgbXAzY29kZWMgPSBudWxsO1xuICAgICAgICBicmVhaztcbiAgICB9XG4gIH0pXG59XG5cbiIsImltcG9ydCBXb3JrZXIgZnJvbSAnd2Vid29ya2lmeSc7XG5sZXQgc2VnbWVudE51bSA9IDA7XG5cbmNvbnN0IFVpbnQ4QXJyYXlUb0Zsb2F0MzJBcnJheSA9ICh1OGEpID0+IHtcbiAgdmFyIGYzMkJ1ZmZlciA9IG5ldyBGbG9hdDMyQXJyYXkodThhLmxlbmd0aCk7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgdThhLmxlbmd0aDsgaSsrKSB7XG4gICAgdmFyIHZhbHVlID0gdThhW2kgPDwgMV0gKyAodThhWyhpIDw8IDEpICsgMV0gPDwgOCk7XG4gICAgaWYgKHZhbHVlID49IDB4ODAwMCkgdmFsdWUgfD0gfjB4N0ZGRjtcbiAgICBmMzJCdWZmZXJbaV0gPSB2YWx1ZSAvIDB4ODAwMDtcbiAgfVxuICByZXR1cm4gZjMyQnVmZmVyO1xufVxuXG5jbGFzcyBSZWNvcmRlciB7XG4gIGNvbnN0cnVjdG9yKHNvdXJjZSwgY2ZnKSB7XG4gICAgdmFyIGNvbmZpZyA9IGNmZyB8fCB7fTtcbiAgICB2YXIgYnVmZmVyTGVuID0gY29uZmlnLmJ1ZmZlckxlbiB8fCA0MDk2O1xuICAgIHZhciBudW1DaGFubmVscyA9IGNvbmZpZy5udW1DaGFubmVscyB8fCAyO1xuICAgIHRoaXMuY29udGV4dCA9IHNvdXJjZS5jb250ZXh0O1xuICAgIHRoaXMubm9kZSA9ICh0aGlzLmNvbnRleHQuY3JlYXRlU2NyaXB0UHJvY2Vzc29yIHx8XG4gICAgICAgIHRoaXMuY29udGV4dC5jcmVhdGVKYXZhU2NyaXB0Tm9kZSlcbiAgICAgIC5jYWxsKHRoaXMuY29udGV4dCxcbiAgICAgICAgYnVmZmVyTGVuLCBudW1DaGFubmVscywgbnVtQ2hhbm5lbHMpO1xuXG4gICAgdGhpcy5yZWNvcmRlcldvcmtlciA9IG5ldyBXb3JrZXIocmVxdWlyZSgnLi9yZWNvcmRlcldvcmtlci5qcycpKTtcbiAgICB0aGlzLnJlY29yZGVyV29ya2VyLm9ubWVzc2FnZSA9IChlKSA9PiB7XG4gICAgICB2YXIgYnVmZmVyID0gbmV3IFVpbnQ4QXJyYXkoZS5kYXRhKTtcbiAgICAgIHNlZ21lbnROdW0rKztcbiAgICAgIGVuY29kZXJXb3JrZXIucG9zdE1lc3NhZ2UoeyBjbWQ6ICdlbmNvZGUnLCBidWY6IFVpbnQ4QXJyYXlUb0Zsb2F0MzJBcnJheShidWZmZXIpIH0pO1xuICAgIH1cbiAgICB0aGlzLnJlY29yZGVyV29ya2VyLnBvc3RNZXNzYWdlKHtcbiAgICAgIGNvbW1hbmQ6ICdpbml0JyxcbiAgICAgIGNvbmZpZzoge1xuICAgICAgICBzYW1wbGVSYXRlOiB0aGlzLmNvbnRleHQuc2FtcGxlUmF0ZSxcbiAgICAgICAgbnVtQ2hhbm5lbHM6IG51bUNoYW5uZWxzXG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBjb25zdCBlbmNvZGVyV29ya2VyID0gbmV3IFdvcmtlcihyZXF1aXJlKCcuL21wM1dvcmtlci5qcycpKTtcbiAgICBlbmNvZGVyV29ya2VyLnBvc3RNZXNzYWdlKHtcbiAgICAgIGNtZDogJ2luaXQnLFxuICAgICAgY29uZmlnOiB7XG4gICAgICAgIG1vZGU6IDMsXG4gICAgICAgIGNoYW5uZWxzOiAxLFxuICAgICAgICBzYW1wbGVyYXRlOiA0NDEwMCxcbiAgICAgICAgYml0cmF0ZTogMTZcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIHRoaXMubm9kZS5vbmF1ZGlvcHJvY2VzcyA9IChlKSA9PiB7XG4gICAgICBjb25zb2xlLmxvZygxMTEpO1xuICAgICAgaWYgKCF0aGlzLnJlY29yZGluZykgcmV0dXJuO1xuICAgICAgdmFyIGJ1ZmZlciA9IFtdO1xuICAgICAgZm9yICh2YXIgY2hhbm5lbCA9IDA7IGNoYW5uZWwgPCBudW1DaGFubmVsczsgY2hhbm5lbCsrKSB7XG4gICAgICAgIGJ1ZmZlci5wdXNoKGUuaW5wdXRCdWZmZXIuZ2V0Q2hhbm5lbERhdGEoY2hhbm5lbCkpO1xuICAgICAgfVxuICAgICAgdGhpcy5yZWNvcmRlcldvcmtlci5wb3N0TWVzc2FnZSh7XG4gICAgICAgIGNvbW1hbmQ6ICdyZWNvcmQnLFxuICAgICAgICBidWZmZXI6IGJ1ZmZlclxuICAgICAgfSk7XG4gICAgfVxuICAgIHNvdXJjZS5jb25uZWN0KHRoaXMubm9kZSk7XG4gICAgdGhpcy5ub2RlLmNvbm5lY3QodGhpcy5jb250ZXh0LmRlc3RpbmF0aW9uKTtcbiAgfVxuXG4gIHJlY29yZCgpIHtcbiAgICB0aGlzLnJlY29yZGluZyA9IHRydWU7XG4gICAgY29uc29sZS5sb2codGhpcy5yZWNvcmRpbmcpO1xuICB9XG5cbiAgc3RvcCgpIHtcbiAgICB0aGlzLnJlY29yZGluZyA9IGZhbHNlO1xuICAgIGNvbnNvbGUubG9nKHRoaXMucmVjb3JkaW5nKTtcbiAgfVxuXG4gIGNsZWFyKCkge1xuICAgIHRoaXMud29ya2VyLnBvc3RNZXNzYWdlKHsgY29tbWFuZDogJ2NsZWFyJyB9KTtcbiAgfVxuXG5cbn1cblxuZXhwb3J0IGRlZmF1bHQgUmVjb3JkZXI7XG5cbiIsInZhciByZWNMZW5ndGggPSAwLFxuICByZWNCdWZmZXJzID0gW10sXG4gIHNhbXBsZVJhdGUsXG4gIG51bUNoYW5uZWxzO1xuXG5mdW5jdGlvbiBpbml0KGNvbmZpZykge1xuICBzYW1wbGVSYXRlID0gY29uZmlnLnNhbXBsZVJhdGU7XG4gIG51bUNoYW5uZWxzID0gY29uZmlnLm51bUNoYW5uZWxzO1xuICBpbml0QnVmZmVycygpO1xufVxuXG5cbmZ1bmN0aW9uIGNsZWFyKCkge1xuICByZWNMZW5ndGggPSAwO1xuICByZWNCdWZmZXJzID0gW107XG4gIGluaXRCdWZmZXJzKCk7XG59XG5cbmZ1bmN0aW9uIGluaXRCdWZmZXJzKCkge1xuICBmb3IgKHZhciBjaGFubmVsID0gMDsgY2hhbm5lbCA8IG51bUNoYW5uZWxzOyBjaGFubmVsKyspIHtcbiAgICByZWNCdWZmZXJzW2NoYW5uZWxdID0gW107XG4gIH1cbn1cblxuZnVuY3Rpb24gbWVyZ2VCdWZmZXJzKHJlY0J1ZmZlcnMsIHJlY0xlbmd0aCkge1xuICB2YXIgcmVzdWx0ID0gbmV3IEZsb2F0MzJBcnJheShyZWNMZW5ndGgpO1xuICB2YXIgb2Zmc2V0ID0gMDtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCByZWNCdWZmZXJzLmxlbmd0aDsgaSsrKSB7XG4gICAgcmVzdWx0LnNldChyZWNCdWZmZXJzW2ldLCBvZmZzZXQpO1xuICAgIG9mZnNldCArPSByZWNCdWZmZXJzW2ldLmxlbmd0aDtcbiAgfVxuICByZXR1cm4gcmVzdWx0O1xufVxuXG5mdW5jdGlvbiBpbnRlcmxlYXZlKGlucHV0TCwgaW5wdXRSKSB7XG4gIHZhciBsZW5ndGggPSBpbnB1dEwubGVuZ3RoICsgaW5wdXRSLmxlbmd0aDtcbiAgdmFyIHJlc3VsdCA9IG5ldyBGbG9hdDMyQXJyYXkobGVuZ3RoKTtcblxuICB2YXIgaW5kZXggPSAwLFxuICAgIGlucHV0SW5kZXggPSAwO1xuXG4gIHdoaWxlIChpbmRleCA8IGxlbmd0aCkge1xuICAgIHJlc3VsdFtpbmRleCsrXSA9IGlucHV0TFtpbnB1dEluZGV4XTtcbiAgICByZXN1bHRbaW5kZXgrK10gPSBpbnB1dFJbaW5wdXRJbmRleF07XG4gICAgaW5wdXRJbmRleCsrO1xuICB9XG4gIHJldHVybiByZXN1bHQ7XG59XG5cbmZ1bmN0aW9uIGZsb2F0VG8xNkJpdFBDTShvdXRwdXQsIG9mZnNldCwgaW5wdXQpIHtcbiAgZm9yICh2YXIgaSA9IDA7IGkgPCBpbnB1dC5sZW5ndGg7IGkrKywgb2Zmc2V0ICs9IDIpIHtcbiAgICB2YXIgcyA9IE1hdGgubWF4KC0xLCBNYXRoLm1pbigxLCBpbnB1dFtpXSkpO1xuICAgIG91dHB1dC5zZXRJbnQxNihvZmZzZXQsIHMgPCAwID8gcyAqIDB4ODAwMCA6IHMgKiAweDdGRkYsIHRydWUpO1xuICB9XG59XG5cbmZ1bmN0aW9uIHdyaXRlU3RyaW5nKHZpZXcsIG9mZnNldCwgc3RyaW5nKSB7XG4gIGZvciAodmFyIGkgPSAwOyBpIDwgc3RyaW5nLmxlbmd0aDsgaSsrKSB7XG4gICAgdmlldy5zZXRVaW50OChvZmZzZXQgKyBpLCBzdHJpbmcuY2hhckNvZGVBdChpKSk7XG4gIH1cbn1cblxuZnVuY3Rpb24gZW5jb2RlV0FWKHNhbXBsZXMpIHtcbiAgdmFyIGJ1ZmZlciA9IG5ldyBBcnJheUJ1ZmZlcihzYW1wbGVzLmxlbmd0aCAqIDIpO1xuICB2YXIgdmlldyA9IG5ldyBEYXRhVmlldyhidWZmZXIpO1xuICBmbG9hdFRvMTZCaXRQQ00odmlldywgMCwgc2FtcGxlcyk7XG4gIHJldHVybiB2aWV3O1xufVxuXG5leHBvcnQgZGVmYXVsdCAoc2VsZikgPT4ge1xuICBzZWxmLmFkZEV2ZW50TGlzdGVuZXIoJ21lc3NhZ2UnLCBlID0+IHtcbiAgICBzd2l0Y2ggKGUuZGF0YS5jb21tYW5kKSB7XG4gICAgICBjYXNlICdpbml0JzpcbiAgICAgICAgaW5pdChlLmRhdGEuY29uZmlnKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdyZWNvcmQnOlxuICAgICAgICByZWNvcmQoZS5kYXRhLmJ1ZmZlcik7XG4gICAgICAgIGJyZWFrO1xuICAgICAgY2FzZSAnZXhwb3J0V0FWJzpcbiAgICAgICAgZXhwb3J0V0FWKGUuZGF0YS50eXBlKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdnZXRCdWZmZXInOlxuICAgICAgICBnZXRCdWZmZXIoKTtcbiAgICAgICAgYnJlYWs7XG4gICAgICBjYXNlICdjbGVhcic6XG4gICAgICAgIGNsZWFyKCk7XG4gICAgICAgIGJyZWFrO1xuICAgIH1cbiAgfSk7XG5cbiAgZnVuY3Rpb24gcmVjb3JkKGlucHV0QnVmZmVyKSB7XG4gICAgZm9yICh2YXIgY2hhbm5lbCA9IDA7IGNoYW5uZWwgPCBudW1DaGFubmVsczsgY2hhbm5lbCsrKSB7XG4gICAgICByZWNCdWZmZXJzW2NoYW5uZWxdID0gW107XG4gICAgICByZWNCdWZmZXJzW2NoYW5uZWxdLnB1c2goaW5wdXRCdWZmZXJbY2hhbm5lbF0pO1xuICAgIH1cbiAgICByZWNMZW5ndGggPSBpbnB1dEJ1ZmZlclswXS5sZW5ndGg7XG4gICAgZXhwb3J0V0FWKCk7XG4gIH1cblxuICBmdW5jdGlvbiBleHBvcnRXQVYoKSB7XG4gICAgdmFyIGJ1ZmZlcnMgPSBbXTtcbiAgICBmb3IgKHZhciBjaGFubmVsID0gMDsgY2hhbm5lbCA8IG51bUNoYW5uZWxzOyBjaGFubmVsKyspIHtcbiAgICAgIGJ1ZmZlcnMucHVzaChtZXJnZUJ1ZmZlcnMocmVjQnVmZmVyc1tjaGFubmVsXSwgcmVjTGVuZ3RoKSk7XG4gICAgfVxuICAgIGlmIChudW1DaGFubmVscyA9PT0gMikge1xuICAgICAgdmFyIGludGVybGVhdmVkID0gaW50ZXJsZWF2ZShidWZmZXJzWzBdLCBidWZmZXJzWzFdKTtcbiAgICB9IGVsc2Uge1xuICAgICAgdmFyIGludGVybGVhdmVkID0gYnVmZmVyc1swXTtcbiAgICB9XG4gICAgdmFyIGRhdGF2aWV3ID0gZW5jb2RlV0FWKGludGVybGVhdmVkKTtcblxuICAgIHNlbGYucG9zdE1lc3NhZ2UoZGF0YXZpZXcuYnVmZmVyKTtcbiAgfVxufVxuXG4iXX0=
